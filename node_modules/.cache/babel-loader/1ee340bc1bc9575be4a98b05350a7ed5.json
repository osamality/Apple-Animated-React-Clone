{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { Vector3, CylinderGeometry, Matrix4, WebGLRenderTarget, RGBAFormat, LinearEncoding, ShaderMaterial, DoubleSide, RepeatWrapping } from 'three';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { FullScreenQuad } from 'three-stdlib';\nimport mergeRefs from 'react-merge-refs';\nimport { SpotLightMaterial } from '../materials/SpotLightMaterial.js';\nimport SpotlightShadowShader from '../helpers/glsl/DefaultSpotlightShadowShadows.glsl.js';\n\nconst isSpotLight = child => {\n  return child == null ? void 0 : child.isSpotLight;\n};\n\nfunction VolumetricMesh({\n  opacity = 1,\n  radiusTop,\n  radiusBottom,\n  depthBuffer,\n  color = 'white',\n  distance = 5,\n  angle = 0.15,\n  attenuation = 5,\n  anglePower = 5\n}) {\n  const mesh = React.useRef(null);\n  const size = useThree(state => state.size);\n  const camera = useThree(state => state.camera);\n  const dpr = useThree(state => state.viewport.dpr);\n  const [material] = React.useState(() => new SpotLightMaterial());\n  const [vec] = React.useState(() => new Vector3());\n  radiusTop = radiusTop === undefined ? 0.1 : radiusTop;\n  radiusBottom = radiusBottom === undefined ? angle * 7 : radiusBottom;\n  useFrame(() => {\n    material.uniforms.spotPosition.value.copy(mesh.current.getWorldPosition(vec));\n    mesh.current.lookAt(mesh.current.parent.target.getWorldPosition(vec));\n  });\n  const geom = React.useMemo(() => {\n    const geometry = new CylinderGeometry(radiusTop, radiusBottom, distance, 128, 64, true);\n    geometry.applyMatrix4(new Matrix4().makeTranslation(0, -distance / 2, 0));\n    geometry.applyMatrix4(new Matrix4().makeRotationX(-Math.PI / 2));\n    return geometry;\n  }, [distance, radiusTop, radiusBottom]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    geometry: geom,\n    raycast: () => null\n  }, /*#__PURE__*/React.createElement(\"primitive\", {\n    object: material,\n    attach: \"material\",\n    \"uniforms-opacity-value\": opacity,\n    \"uniforms-lightColor-value\": color,\n    \"uniforms-attenuation-value\": attenuation,\n    \"uniforms-anglePower-value\": anglePower,\n    \"uniforms-depth-value\": depthBuffer,\n    \"uniforms-cameraNear-value\": camera.near,\n    \"uniforms-cameraFar-value\": camera.far,\n    \"uniforms-resolution-value\": depthBuffer ? [size.width * dpr, size.height * dpr] : [0, 0]\n  })));\n}\n\nfunction useCommon(spotlight, mesh, width, height, distance) {\n  const [[pos, dir]] = React.useState(() => [new Vector3(), new Vector3()]);\n  React.useLayoutEffect(() => {\n    if (isSpotLight(spotlight.current)) {\n      console.log(spotlight.current);\n      spotlight.current.shadow.mapSize.set(width, height);\n      spotlight.current.shadow.needsUpdate = true;\n    } else {\n      throw new Error('SpotlightShadow must be a child of a SpotLight');\n    }\n  }, [spotlight, width, height]);\n  useFrame(() => {\n    if (!spotlight.current) return;\n    const A = spotlight.current.position;\n    const B = spotlight.current.target.position;\n    dir.copy(B).sub(A);\n    var len = dir.length();\n    dir.normalize().multiplyScalar(len * distance);\n    pos.copy(A).add(dir);\n    mesh.current.position.copy(pos);\n    mesh.current.lookAt(spotlight.current.target.position);\n  });\n}\n\nfunction SpotlightShadowWithShader({\n  distance = 0.4,\n  alphaTest = 0.5,\n  map,\n  shader = SpotlightShadowShader,\n  width = 512,\n  height = 512,\n  scale = 1,\n  children,\n  ...rest\n}) {\n  const mesh = React.useRef(null);\n  const spotlight = rest.spotlightRef;\n  const debug = rest.debug;\n  useCommon(spotlight, mesh, width, height, distance);\n  const renderTarget = React.useMemo(() => new WebGLRenderTarget(width, height, {\n    format: RGBAFormat,\n    encoding: LinearEncoding,\n    stencilBuffer: false // depthTexture: null!\n\n  }), [width, height]);\n  const uniforms = React.useRef({\n    uShadowMap: {\n      value: map\n    },\n    uTime: {\n      value: 0\n    }\n  });\n  React.useEffect(() => void (uniforms.current.uShadowMap.value = map), [map]);\n  const fsQuad = React.useMemo(() => new FullScreenQuad(new ShaderMaterial({\n    uniforms: uniforms.current,\n    vertexShader:\n    /* glsl */\n    `\n          varying vec2 vUv;\n\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n          `,\n    fragmentShader: shader\n  })), [shader]);\n  React.useEffect(() => () => {\n    fsQuad.material.dispose();\n    fsQuad.dispose();\n  }, [fsQuad]);\n  React.useEffect(() => () => renderTarget.dispose(), [renderTarget]);\n  useFrame(({\n    gl\n  }, dt) => {\n    uniforms.current.uTime.value += dt;\n    gl.setRenderTarget(renderTarget);\n    fsQuad.render(gl);\n    gl.setRenderTarget(null);\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    scale: scale,\n    castShadow: true\n  }, /*#__PURE__*/React.createElement(\"planeGeometry\", null), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    transparent: true,\n    side: DoubleSide,\n    alphaTest: alphaTest,\n    alphaMap: renderTarget.texture,\n    \"alphaMap-wrapS\": RepeatWrapping,\n    \"alphaMap-wrapT\": RepeatWrapping,\n    opacity: debug ? 1 : 0\n  }, children)));\n}\n\nfunction SpotlightShadowWithoutShader({\n  distance = 0.4,\n  alphaTest = 0.5,\n  map,\n  width = 512,\n  height = 512,\n  scale,\n  children,\n  ...rest\n}) {\n  const mesh = React.useRef(null);\n  const spotlight = rest.spotlightRef;\n  const debug = rest.debug;\n  useCommon(spotlight, mesh, width, height, distance);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    scale: scale,\n    castShadow: true\n  }, /*#__PURE__*/React.createElement(\"planeGeometry\", null), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    transparent: true,\n    side: DoubleSide,\n    alphaTest: alphaTest,\n    alphaMap: map,\n    \"alphaMap-wrapS\": RepeatWrapping,\n    \"alphaMap-wrapT\": RepeatWrapping,\n    opacity: debug ? 1 : 0\n  }, children)));\n}\n\nfunction SpotLightShadow(props) {\n  if (props.shader) return /*#__PURE__*/React.createElement(SpotlightShadowWithShader, props);\n  return /*#__PURE__*/React.createElement(SpotlightShadowWithoutShader, props);\n}\n\nconst SpotLight = /*#__PURE__*/React.forwardRef(({\n  // Volumetric\n  opacity = 1,\n  radiusTop,\n  radiusBottom,\n  depthBuffer,\n  color = 'white',\n  distance = 5,\n  angle = 0.15,\n  attenuation = 5,\n  anglePower = 5,\n  volumetric = true,\n  debug = false,\n  children,\n  ...props\n}, ref) => {\n  const spotlight = React.useRef(null);\n  return /*#__PURE__*/React.createElement(\"group\", null, debug && spotlight.current && /*#__PURE__*/React.createElement(\"spotLightHelper\", {\n    args: [spotlight.current]\n  }), /*#__PURE__*/React.createElement(\"spotLight\", _extends({\n    ref: mergeRefs([ref, spotlight]),\n    angle: angle,\n    color: color,\n    distance: distance,\n    castShadow: true\n  }, props), volumetric && /*#__PURE__*/React.createElement(VolumetricMesh, {\n    debug: debug,\n    opacity: opacity,\n    radiusTop: radiusTop,\n    radiusBottom: radiusBottom,\n    depthBuffer: depthBuffer,\n    color: color,\n    distance: distance,\n    angle: angle,\n    attenuation: attenuation,\n    anglePower: anglePower\n  })), children && /*#__PURE__*/React.cloneElement(children, {\n    spotlightRef: spotlight,\n    debug: debug\n  }));\n});\nexport { SpotLight, SpotLightShadow };","map":{"version":3,"sources":["/Users/osamakhan/Desktop/Apple-Website-Clone-React-master/node_modules/@react-three/drei/core/SpotLight.js"],"names":["_extends","React","Vector3","CylinderGeometry","Matrix4","WebGLRenderTarget","RGBAFormat","LinearEncoding","ShaderMaterial","DoubleSide","RepeatWrapping","useThree","useFrame","FullScreenQuad","mergeRefs","SpotLightMaterial","SpotlightShadowShader","isSpotLight","child","VolumetricMesh","opacity","radiusTop","radiusBottom","depthBuffer","color","distance","angle","attenuation","anglePower","mesh","useRef","size","state","camera","dpr","viewport","material","useState","vec","undefined","uniforms","spotPosition","value","copy","current","getWorldPosition","lookAt","parent","target","geom","useMemo","geometry","applyMatrix4","makeTranslation","makeRotationX","Math","PI","createElement","Fragment","ref","raycast","object","attach","near","far","width","height","useCommon","spotlight","pos","dir","useLayoutEffect","console","log","shadow","mapSize","set","needsUpdate","Error","A","position","B","sub","len","length","normalize","multiplyScalar","add","SpotlightShadowWithShader","alphaTest","map","shader","scale","children","rest","spotlightRef","debug","renderTarget","format","encoding","stencilBuffer","uShadowMap","uTime","useEffect","fsQuad","vertexShader","fragmentShader","dispose","gl","dt","setRenderTarget","render","castShadow","transparent","side","alphaMap","texture","SpotlightShadowWithoutShader","SpotLightShadow","props","SpotLight","forwardRef","volumetric","args","cloneElement"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { Vector3, CylinderGeometry, Matrix4, WebGLRenderTarget, RGBAFormat, LinearEncoding, ShaderMaterial, DoubleSide, RepeatWrapping } from 'three';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { FullScreenQuad } from 'three-stdlib';\nimport mergeRefs from 'react-merge-refs';\nimport { SpotLightMaterial } from '../materials/SpotLightMaterial.js';\nimport SpotlightShadowShader from '../helpers/glsl/DefaultSpotlightShadowShadows.glsl.js';\n\nconst isSpotLight = child => {\n  return child == null ? void 0 : child.isSpotLight;\n};\n\nfunction VolumetricMesh({\n  opacity = 1,\n  radiusTop,\n  radiusBottom,\n  depthBuffer,\n  color = 'white',\n  distance = 5,\n  angle = 0.15,\n  attenuation = 5,\n  anglePower = 5\n}) {\n  const mesh = React.useRef(null);\n  const size = useThree(state => state.size);\n  const camera = useThree(state => state.camera);\n  const dpr = useThree(state => state.viewport.dpr);\n  const [material] = React.useState(() => new SpotLightMaterial());\n  const [vec] = React.useState(() => new Vector3());\n  radiusTop = radiusTop === undefined ? 0.1 : radiusTop;\n  radiusBottom = radiusBottom === undefined ? angle * 7 : radiusBottom;\n  useFrame(() => {\n    material.uniforms.spotPosition.value.copy(mesh.current.getWorldPosition(vec));\n    mesh.current.lookAt(mesh.current.parent.target.getWorldPosition(vec));\n  });\n  const geom = React.useMemo(() => {\n    const geometry = new CylinderGeometry(radiusTop, radiusBottom, distance, 128, 64, true);\n    geometry.applyMatrix4(new Matrix4().makeTranslation(0, -distance / 2, 0));\n    geometry.applyMatrix4(new Matrix4().makeRotationX(-Math.PI / 2));\n    return geometry;\n  }, [distance, radiusTop, radiusBottom]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    geometry: geom,\n    raycast: () => null\n  }, /*#__PURE__*/React.createElement(\"primitive\", {\n    object: material,\n    attach: \"material\",\n    \"uniforms-opacity-value\": opacity,\n    \"uniforms-lightColor-value\": color,\n    \"uniforms-attenuation-value\": attenuation,\n    \"uniforms-anglePower-value\": anglePower,\n    \"uniforms-depth-value\": depthBuffer,\n    \"uniforms-cameraNear-value\": camera.near,\n    \"uniforms-cameraFar-value\": camera.far,\n    \"uniforms-resolution-value\": depthBuffer ? [size.width * dpr, size.height * dpr] : [0, 0]\n  })));\n}\n\nfunction useCommon(spotlight, mesh, width, height, distance) {\n  const [[pos, dir]] = React.useState(() => [new Vector3(), new Vector3()]);\n  React.useLayoutEffect(() => {\n    if (isSpotLight(spotlight.current)) {\n      console.log(spotlight.current);\n      spotlight.current.shadow.mapSize.set(width, height);\n      spotlight.current.shadow.needsUpdate = true;\n    } else {\n      throw new Error('SpotlightShadow must be a child of a SpotLight');\n    }\n  }, [spotlight, width, height]);\n  useFrame(() => {\n    if (!spotlight.current) return;\n    const A = spotlight.current.position;\n    const B = spotlight.current.target.position;\n    dir.copy(B).sub(A);\n    var len = dir.length();\n    dir.normalize().multiplyScalar(len * distance);\n    pos.copy(A).add(dir);\n    mesh.current.position.copy(pos);\n    mesh.current.lookAt(spotlight.current.target.position);\n  });\n}\n\nfunction SpotlightShadowWithShader({\n  distance = 0.4,\n  alphaTest = 0.5,\n  map,\n  shader = SpotlightShadowShader,\n  width = 512,\n  height = 512,\n  scale = 1,\n  children,\n  ...rest\n}) {\n  const mesh = React.useRef(null);\n  const spotlight = rest.spotlightRef;\n  const debug = rest.debug;\n  useCommon(spotlight, mesh, width, height, distance);\n  const renderTarget = React.useMemo(() => new WebGLRenderTarget(width, height, {\n    format: RGBAFormat,\n    encoding: LinearEncoding,\n    stencilBuffer: false // depthTexture: null!\n\n  }), [width, height]);\n  const uniforms = React.useRef({\n    uShadowMap: {\n      value: map\n    },\n    uTime: {\n      value: 0\n    }\n  });\n  React.useEffect(() => void (uniforms.current.uShadowMap.value = map), [map]);\n  const fsQuad = React.useMemo(() => new FullScreenQuad(new ShaderMaterial({\n    uniforms: uniforms.current,\n    vertexShader:\n    /* glsl */\n    `\n          varying vec2 vUv;\n\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n          }\n          `,\n    fragmentShader: shader\n  })), [shader]);\n  React.useEffect(() => () => {\n    fsQuad.material.dispose();\n    fsQuad.dispose();\n  }, [fsQuad]);\n  React.useEffect(() => () => renderTarget.dispose(), [renderTarget]);\n  useFrame(({\n    gl\n  }, dt) => {\n    uniforms.current.uTime.value += dt;\n    gl.setRenderTarget(renderTarget);\n    fsQuad.render(gl);\n    gl.setRenderTarget(null);\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    scale: scale,\n    castShadow: true\n  }, /*#__PURE__*/React.createElement(\"planeGeometry\", null), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    transparent: true,\n    side: DoubleSide,\n    alphaTest: alphaTest,\n    alphaMap: renderTarget.texture,\n    \"alphaMap-wrapS\": RepeatWrapping,\n    \"alphaMap-wrapT\": RepeatWrapping,\n    opacity: debug ? 1 : 0\n  }, children)));\n}\n\nfunction SpotlightShadowWithoutShader({\n  distance = 0.4,\n  alphaTest = 0.5,\n  map,\n  width = 512,\n  height = 512,\n  scale,\n  children,\n  ...rest\n}) {\n  const mesh = React.useRef(null);\n  const spotlight = rest.spotlightRef;\n  const debug = rest.debug;\n  useCommon(spotlight, mesh, width, height, distance);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: mesh,\n    scale: scale,\n    castShadow: true\n  }, /*#__PURE__*/React.createElement(\"planeGeometry\", null), /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    transparent: true,\n    side: DoubleSide,\n    alphaTest: alphaTest,\n    alphaMap: map,\n    \"alphaMap-wrapS\": RepeatWrapping,\n    \"alphaMap-wrapT\": RepeatWrapping,\n    opacity: debug ? 1 : 0\n  }, children)));\n}\n\nfunction SpotLightShadow(props) {\n  if (props.shader) return /*#__PURE__*/React.createElement(SpotlightShadowWithShader, props);\n  return /*#__PURE__*/React.createElement(SpotlightShadowWithoutShader, props);\n}\nconst SpotLight = /*#__PURE__*/React.forwardRef(({\n  // Volumetric\n  opacity = 1,\n  radiusTop,\n  radiusBottom,\n  depthBuffer,\n  color = 'white',\n  distance = 5,\n  angle = 0.15,\n  attenuation = 5,\n  anglePower = 5,\n  volumetric = true,\n  debug = false,\n  children,\n  ...props\n}, ref) => {\n  const spotlight = React.useRef(null);\n  return /*#__PURE__*/React.createElement(\"group\", null, debug && spotlight.current && /*#__PURE__*/React.createElement(\"spotLightHelper\", {\n    args: [spotlight.current]\n  }), /*#__PURE__*/React.createElement(\"spotLight\", _extends({\n    ref: mergeRefs([ref, spotlight]),\n    angle: angle,\n    color: color,\n    distance: distance,\n    castShadow: true\n  }, props), volumetric && /*#__PURE__*/React.createElement(VolumetricMesh, {\n    debug: debug,\n    opacity: opacity,\n    radiusTop: radiusTop,\n    radiusBottom: radiusBottom,\n    depthBuffer: depthBuffer,\n    color: color,\n    distance: distance,\n    angle: angle,\n    attenuation: attenuation,\n    anglePower: anglePower\n  })), children && /*#__PURE__*/React.cloneElement(children, {\n    spotlightRef: spotlight,\n    debug: debug\n  }));\n});\n\nexport { SpotLight, SpotLightShadow };\n"]},"metadata":{},"sourceType":"module"}