{"ast":null,"code":"import { DepthTexture, DepthStencilFormat, UnsignedInt248Type, WebGLRenderTarget, NearestFilter, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, DstColorFactor, ZeroFactor, AddEquation, DstAlphaFactor, Color, LuminanceFormat, CustomBlending, Vector3, MathUtils, DataTexture, RedFormat, FloatType, RepeatWrapping } from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { SimplexNoise } from '../math/SimplexNoise.js';\nimport { SSAOShader, SSAOBlurShader, SSAODepthShader } from '../shaders/SSAOShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nclass SSAOPass extends Pass {\n  constructor(scene, camera, width, height) {\n    super();\n    this.width = width !== undefined ? width : 512;\n    this.height = height !== undefined ? height : 512;\n    this.clear = true;\n    this.camera = camera;\n    this.scene = scene;\n    this.kernelRadius = 8;\n    this.kernelSize = 32;\n    this.kernel = [];\n    this.noiseTexture = null;\n    this.output = 0;\n    this.minDistance = 0.005;\n    this.maxDistance = 0.1;\n    this._visibilityCache = new Map(); //\n\n    this.generateSampleKernel();\n    this.generateRandomKernelRotations(); // beauty render target\n\n    const depthTexture = new DepthTexture();\n    depthTexture.format = DepthStencilFormat;\n    depthTexture.type = UnsignedInt248Type;\n    this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height); // normal render target with depth buffer\n\n    this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter,\n      depthTexture: depthTexture\n    }); // ssao render target\n\n    this.ssaoRenderTarget = new WebGLRenderTarget(this.width, this.height);\n    this.blurRenderTarget = this.ssaoRenderTarget.clone(); // ssao material\n\n    if (SSAOShader === undefined) {\n      console.error('THREE.SSAOPass: The pass relies on SSAOShader.');\n    }\n\n    this.ssaoMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOShader.defines),\n      uniforms: UniformsUtils.clone(SSAOShader.uniforms),\n      vertexShader: SSAOShader.vertexShader,\n      fragmentShader: SSAOShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.ssaoMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.ssaoMaterial.uniforms['tNoise'].value = this.noiseTexture;\n    this.ssaoMaterial.uniforms['kernel'].value = this.kernel;\n    this.ssaoMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.ssaoMaterial.uniforms['cameraFar'].value = this.camera.far;\n    this.ssaoMaterial.uniforms['resolution'].value.set(this.width, this.height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n    this.normalMaterial = new MeshNormalMaterial();\n    this.normalMaterial.blending = NoBlending; // blur material\n\n    this.blurMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOBlurShader.defines),\n      uniforms: UniformsUtils.clone(SSAOBlurShader.uniforms),\n      vertexShader: SSAOBlurShader.vertexShader,\n      fragmentShader: SSAOBlurShader.fragmentShader\n    });\n    this.blurMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n    this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // material for rendering the depth\n\n    this.depthRenderMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAODepthShader.defines),\n      uniforms: UniformsUtils.clone(SSAODepthShader.uniforms),\n      vertexShader: SSAODepthShader.vertexShader,\n      fragmentShader: SSAODepthShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.depthRenderMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n    this.copyMaterial = new ShaderMaterial({\n      uniforms: UniformsUtils.clone(CopyShader.uniforms),\n      vertexShader: CopyShader.vertexShader,\n      fragmentShader: CopyShader.fragmentShader,\n      transparent: true,\n      depthTest: false,\n      depthWrite: false,\n      blendSrc: DstColorFactor,\n      blendDst: ZeroFactor,\n      blendEquation: AddEquation,\n      blendSrcAlpha: DstAlphaFactor,\n      blendDstAlpha: ZeroFactor,\n      blendEquationAlpha: AddEquation\n    });\n    this.fsQuad = new FullScreenQuad(null);\n    this.originalClearColor = new Color();\n  }\n\n  dispose() {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.normalRenderTarget.dispose();\n    this.ssaoRenderTarget.dispose();\n    this.blurRenderTarget.dispose(); // dispose materials\n\n    this.normalMaterial.dispose();\n    this.blurMaterial.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  }\n\n  render(renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */\n  ) {\n    if (renderer.capabilities.isWebGL2 === false) this.noiseTexture.format = LuminanceFormat; // render beauty\n\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // render normals and depth (honor only meshes, points and lines do not contribute to SSAO)\n\n    this.overrideVisibility();\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0x7777ff, 1.0);\n    this.restoreVisibility(); // render SSAO\n\n    this.ssaoMaterial.uniforms['kernelRadius'].value = this.kernelRadius;\n    this.ssaoMaterial.uniforms['minDistance'].value = this.minDistance;\n    this.ssaoMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.renderPass(renderer, this.ssaoMaterial, this.ssaoRenderTarget); // render blur\n\n    this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget); // output result to screen\n\n    switch (this.output) {\n      case SSAOPass.OUTPUT.SSAO:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Blur:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Default:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = CustomBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      default:\n        console.warn('THREE.SSAOPass: Unknown output type.');\n    }\n  }\n\n  renderPass(renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n\n  renderOverride(renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n\n  setSize(width, height) {\n    this.width = width;\n    this.height = height;\n    this.beautyRenderTarget.setSize(width, height);\n    this.ssaoRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.ssaoMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n  }\n\n  generateSampleKernel() {\n    const kernelSize = this.kernelSize;\n    const kernel = this.kernel;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const sample = new Vector3();\n      sample.x = Math.random() * 2 - 1;\n      sample.y = Math.random() * 2 - 1;\n      sample.z = Math.random();\n      sample.normalize();\n      let scale = i / kernelSize;\n      scale = MathUtils.lerp(0.1, 1, scale * scale);\n      sample.multiplyScalar(scale);\n      kernel.push(sample);\n    }\n  }\n\n  generateRandomKernelRotations() {\n    const width = 4,\n          height = 4;\n\n    if (SimplexNoise === undefined) {\n      console.error('THREE.SSAOPass: The pass relies on SimplexNoise.');\n    }\n\n    const simplex = new SimplexNoise();\n    const size = width * height;\n    const data = new Float32Array(size);\n\n    for (let i = 0; i < size; i++) {\n      const x = Math.random() * 2 - 1;\n      const y = Math.random() * 2 - 1;\n      const z = 0;\n      data[i] = simplex.noise3d(x, y, z);\n    }\n\n    this.noiseTexture = new DataTexture(data, width, height, RedFormat, FloatType);\n    this.noiseTexture.wrapS = RepeatWrapping;\n    this.noiseTexture.wrapT = RepeatWrapping;\n    this.noiseTexture.needsUpdate = true;\n  }\n\n  overrideVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      cache.set(object, object.visible);\n      if (object.isPoints || object.isLine) object.visible = false;\n    });\n  }\n\n  restoreVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      const visible = cache.get(object);\n      object.visible = visible;\n    });\n    cache.clear();\n  }\n\n}\n\nSSAOPass.OUTPUT = {\n  Default: 0,\n  SSAO: 1,\n  Blur: 2,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5\n};\nexport { SSAOPass };","map":{"version":3,"sources":["/Users/osamakhan/Desktop/dev/Apple-Animated-React-Clone/node_modules/three-stdlib/postprocessing/SSAOPass.js"],"names":["DepthTexture","DepthStencilFormat","UnsignedInt248Type","WebGLRenderTarget","NearestFilter","ShaderMaterial","UniformsUtils","NoBlending","MeshNormalMaterial","DstColorFactor","ZeroFactor","AddEquation","DstAlphaFactor","Color","LuminanceFormat","CustomBlending","Vector3","MathUtils","DataTexture","RedFormat","FloatType","RepeatWrapping","Pass","FullScreenQuad","SimplexNoise","SSAOShader","SSAOBlurShader","SSAODepthShader","CopyShader","SSAOPass","constructor","scene","camera","width","height","undefined","clear","kernelRadius","kernelSize","kernel","noiseTexture","output","minDistance","maxDistance","_visibilityCache","Map","generateSampleKernel","generateRandomKernelRotations","depthTexture","format","type","beautyRenderTarget","normalRenderTarget","minFilter","magFilter","ssaoRenderTarget","blurRenderTarget","clone","console","error","ssaoMaterial","defines","Object","assign","uniforms","vertexShader","fragmentShader","blending","value","texture","near","far","set","copy","projectionMatrix","projectionMatrixInverse","normalMaterial","blurMaterial","depthRenderMaterial","copyMaterial","transparent","depthTest","depthWrite","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","fsQuad","originalClearColor","dispose","render","renderer","writeBuffer","capabilities","isWebGL2","setRenderTarget","overrideVisibility","renderOverride","restoreVisibility","renderPass","OUTPUT","SSAO","renderToScreen","Blur","Beauty","Depth","Normal","Default","warn","passMaterial","renderTarget","clearColor","clearAlpha","getClearColor","originalClearAlpha","getClearAlpha","originalAutoClear","autoClear","setClearColor","setClearAlpha","material","overrideMaterial","setSize","i","sample","x","Math","random","y","z","normalize","scale","lerp","multiplyScalar","push","simplex","size","data","Float32Array","noise3d","wrapS","wrapT","needsUpdate","cache","traverse","object","visible","isPoints","isLine","get"],"mappings":"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","sourcesContent":["import { DepthTexture, DepthStencilFormat, UnsignedInt248Type, WebGLRenderTarget, NearestFilter, ShaderMaterial, UniformsUtils, NoBlending, MeshNormalMaterial, DstColorFactor, ZeroFactor, AddEquation, DstAlphaFactor, Color, LuminanceFormat, CustomBlending, Vector3, MathUtils, DataTexture, RedFormat, FloatType, RepeatWrapping } from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { SimplexNoise } from '../math/SimplexNoise.js';\nimport { SSAOShader, SSAOBlurShader, SSAODepthShader } from '../shaders/SSAOShader.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nclass SSAOPass extends Pass {\n  constructor(scene, camera, width, height) {\n    super();\n    this.width = width !== undefined ? width : 512;\n    this.height = height !== undefined ? height : 512;\n    this.clear = true;\n    this.camera = camera;\n    this.scene = scene;\n    this.kernelRadius = 8;\n    this.kernelSize = 32;\n    this.kernel = [];\n    this.noiseTexture = null;\n    this.output = 0;\n    this.minDistance = 0.005;\n    this.maxDistance = 0.1;\n    this._visibilityCache = new Map(); //\n\n    this.generateSampleKernel();\n    this.generateRandomKernelRotations(); // beauty render target\n\n    const depthTexture = new DepthTexture();\n    depthTexture.format = DepthStencilFormat;\n    depthTexture.type = UnsignedInt248Type;\n    this.beautyRenderTarget = new WebGLRenderTarget(this.width, this.height); // normal render target with depth buffer\n\n    this.normalRenderTarget = new WebGLRenderTarget(this.width, this.height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter,\n      depthTexture: depthTexture\n    }); // ssao render target\n\n    this.ssaoRenderTarget = new WebGLRenderTarget(this.width, this.height);\n    this.blurRenderTarget = this.ssaoRenderTarget.clone(); // ssao material\n\n    if (SSAOShader === undefined) {\n      console.error('THREE.SSAOPass: The pass relies on SSAOShader.');\n    }\n\n    this.ssaoMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOShader.defines),\n      uniforms: UniformsUtils.clone(SSAOShader.uniforms),\n      vertexShader: SSAOShader.vertexShader,\n      fragmentShader: SSAOShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.ssaoMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tNormal'].value = this.normalRenderTarget.texture;\n    this.ssaoMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.ssaoMaterial.uniforms['tNoise'].value = this.noiseTexture;\n    this.ssaoMaterial.uniforms['kernel'].value = this.kernel;\n    this.ssaoMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.ssaoMaterial.uniforms['cameraFar'].value = this.camera.far;\n    this.ssaoMaterial.uniforms['resolution'].value.set(this.width, this.height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse); // normal material\n\n    this.normalMaterial = new MeshNormalMaterial();\n    this.normalMaterial.blending = NoBlending; // blur material\n\n    this.blurMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAOBlurShader.defines),\n      uniforms: UniformsUtils.clone(SSAOBlurShader.uniforms),\n      vertexShader: SSAOBlurShader.vertexShader,\n      fragmentShader: SSAOBlurShader.fragmentShader\n    });\n    this.blurMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n    this.blurMaterial.uniforms['resolution'].value.set(this.width, this.height); // material for rendering the depth\n\n    this.depthRenderMaterial = new ShaderMaterial({\n      defines: Object.assign({}, SSAODepthShader.defines),\n      uniforms: UniformsUtils.clone(SSAODepthShader.uniforms),\n      vertexShader: SSAODepthShader.vertexShader,\n      fragmentShader: SSAODepthShader.fragmentShader,\n      blending: NoBlending\n    });\n    this.depthRenderMaterial.uniforms['tDepth'].value = this.normalRenderTarget.depthTexture;\n    this.depthRenderMaterial.uniforms['cameraNear'].value = this.camera.near;\n    this.depthRenderMaterial.uniforms['cameraFar'].value = this.camera.far; // material for rendering the content of a render target\n\n    this.copyMaterial = new ShaderMaterial({\n      uniforms: UniformsUtils.clone(CopyShader.uniforms),\n      vertexShader: CopyShader.vertexShader,\n      fragmentShader: CopyShader.fragmentShader,\n      transparent: true,\n      depthTest: false,\n      depthWrite: false,\n      blendSrc: DstColorFactor,\n      blendDst: ZeroFactor,\n      blendEquation: AddEquation,\n      blendSrcAlpha: DstAlphaFactor,\n      blendDstAlpha: ZeroFactor,\n      blendEquationAlpha: AddEquation\n    });\n    this.fsQuad = new FullScreenQuad(null);\n    this.originalClearColor = new Color();\n  }\n\n  dispose() {\n    // dispose render targets\n    this.beautyRenderTarget.dispose();\n    this.normalRenderTarget.dispose();\n    this.ssaoRenderTarget.dispose();\n    this.blurRenderTarget.dispose(); // dispose materials\n\n    this.normalMaterial.dispose();\n    this.blurMaterial.dispose();\n    this.copyMaterial.dispose();\n    this.depthRenderMaterial.dispose(); // dipsose full screen quad\n\n    this.fsQuad.dispose();\n  }\n\n  render(renderer, writeBuffer\n  /*, readBuffer, deltaTime, maskActive */\n  ) {\n    if (renderer.capabilities.isWebGL2 === false) this.noiseTexture.format = LuminanceFormat; // render beauty\n\n    renderer.setRenderTarget(this.beautyRenderTarget);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // render normals and depth (honor only meshes, points and lines do not contribute to SSAO)\n\n    this.overrideVisibility();\n    this.renderOverride(renderer, this.normalMaterial, this.normalRenderTarget, 0x7777ff, 1.0);\n    this.restoreVisibility(); // render SSAO\n\n    this.ssaoMaterial.uniforms['kernelRadius'].value = this.kernelRadius;\n    this.ssaoMaterial.uniforms['minDistance'].value = this.minDistance;\n    this.ssaoMaterial.uniforms['maxDistance'].value = this.maxDistance;\n    this.renderPass(renderer, this.ssaoMaterial, this.ssaoRenderTarget); // render blur\n\n    this.renderPass(renderer, this.blurMaterial, this.blurRenderTarget); // output result to screen\n\n    switch (this.output) {\n      case SSAOPass.OUTPUT.SSAO:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.ssaoRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Blur:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Beauty:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Depth:\n        this.renderPass(renderer, this.depthRenderMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Normal:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.normalRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      case SSAOPass.OUTPUT.Default:\n        this.copyMaterial.uniforms['tDiffuse'].value = this.beautyRenderTarget.texture;\n        this.copyMaterial.blending = NoBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        this.copyMaterial.uniforms['tDiffuse'].value = this.blurRenderTarget.texture;\n        this.copyMaterial.blending = CustomBlending;\n        this.renderPass(renderer, this.copyMaterial, this.renderToScreen ? null : writeBuffer);\n        break;\n\n      default:\n        console.warn('THREE.SSAOPass: Unknown output type.');\n    }\n  }\n\n  renderPass(renderer, passMaterial, renderTarget, clearColor, clearAlpha) {\n    // save original state\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget); // setup pass state\n\n    renderer.autoClear = false;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.fsQuad.material = passMaterial;\n    this.fsQuad.render(renderer); // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n\n  renderOverride(renderer, overrideMaterial, renderTarget, clearColor, clearAlpha) {\n    renderer.getClearColor(this.originalClearColor);\n    const originalClearAlpha = renderer.getClearAlpha();\n    const originalAutoClear = renderer.autoClear;\n    renderer.setRenderTarget(renderTarget);\n    renderer.autoClear = false;\n    clearColor = overrideMaterial.clearColor || clearColor;\n    clearAlpha = overrideMaterial.clearAlpha || clearAlpha;\n\n    if (clearColor !== undefined && clearColor !== null) {\n      renderer.setClearColor(clearColor);\n      renderer.setClearAlpha(clearAlpha || 0.0);\n      renderer.clear();\n    }\n\n    this.scene.overrideMaterial = overrideMaterial;\n    renderer.render(this.scene, this.camera);\n    this.scene.overrideMaterial = null; // restore original state\n\n    renderer.autoClear = originalAutoClear;\n    renderer.setClearColor(this.originalClearColor);\n    renderer.setClearAlpha(originalClearAlpha);\n  }\n\n  setSize(width, height) {\n    this.width = width;\n    this.height = height;\n    this.beautyRenderTarget.setSize(width, height);\n    this.ssaoRenderTarget.setSize(width, height);\n    this.normalRenderTarget.setSize(width, height);\n    this.blurRenderTarget.setSize(width, height);\n    this.ssaoMaterial.uniforms['resolution'].value.set(width, height);\n    this.ssaoMaterial.uniforms['cameraProjectionMatrix'].value.copy(this.camera.projectionMatrix);\n    this.ssaoMaterial.uniforms['cameraInverseProjectionMatrix'].value.copy(this.camera.projectionMatrixInverse);\n    this.blurMaterial.uniforms['resolution'].value.set(width, height);\n  }\n\n  generateSampleKernel() {\n    const kernelSize = this.kernelSize;\n    const kernel = this.kernel;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const sample = new Vector3();\n      sample.x = Math.random() * 2 - 1;\n      sample.y = Math.random() * 2 - 1;\n      sample.z = Math.random();\n      sample.normalize();\n      let scale = i / kernelSize;\n      scale = MathUtils.lerp(0.1, 1, scale * scale);\n      sample.multiplyScalar(scale);\n      kernel.push(sample);\n    }\n  }\n\n  generateRandomKernelRotations() {\n    const width = 4,\n          height = 4;\n\n    if (SimplexNoise === undefined) {\n      console.error('THREE.SSAOPass: The pass relies on SimplexNoise.');\n    }\n\n    const simplex = new SimplexNoise();\n    const size = width * height;\n    const data = new Float32Array(size);\n\n    for (let i = 0; i < size; i++) {\n      const x = Math.random() * 2 - 1;\n      const y = Math.random() * 2 - 1;\n      const z = 0;\n      data[i] = simplex.noise3d(x, y, z);\n    }\n\n    this.noiseTexture = new DataTexture(data, width, height, RedFormat, FloatType);\n    this.noiseTexture.wrapS = RepeatWrapping;\n    this.noiseTexture.wrapT = RepeatWrapping;\n    this.noiseTexture.needsUpdate = true;\n  }\n\n  overrideVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      cache.set(object, object.visible);\n      if (object.isPoints || object.isLine) object.visible = false;\n    });\n  }\n\n  restoreVisibility() {\n    const scene = this.scene;\n    const cache = this._visibilityCache;\n    scene.traverse(function (object) {\n      const visible = cache.get(object);\n      object.visible = visible;\n    });\n    cache.clear();\n  }\n\n}\n\nSSAOPass.OUTPUT = {\n  Default: 0,\n  SSAO: 1,\n  Blur: 2,\n  Beauty: 3,\n  Depth: 4,\n  Normal: 5\n};\n\nexport { SSAOPass };\n"]},"metadata":{},"sourceType":"module"}