{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.collectMethods = exports.LooksAhead = void 0;\n\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\n\nvar has_1 = __importDefault(require(\"lodash/has\"));\n\nvar parser_1 = require(\"../parser\");\n\nvar keys_1 = require(\"../../grammar/keys\");\n\nvar gast_1 = require(\"@chevrotain/gast\");\n\nvar gast_2 = require(\"@chevrotain/gast\");\n\nvar llk_lookahead_1 = require(\"../../grammar/llk_lookahead\");\n/**\n * Trait responsible for the lookahead related utilities and optimizations.\n */\n\n\nvar LooksAhead =\n/** @class */\nfunction () {\n  function LooksAhead() {}\n\n  LooksAhead.prototype.initLooksAhead = function (config) {\n    this.dynamicTokensEnabled = (0, has_1.default)(config, \"dynamicTokensEnabled\") ? config.dynamicTokensEnabled // assumes end user provides the correct config value/type\n    : parser_1.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled;\n    this.maxLookahead = (0, has_1.default)(config, \"maxLookahead\") ? config.maxLookahead // assumes end user provides the correct config value/type\n    : parser_1.DEFAULT_PARSER_CONFIG.maxLookahead;\n    this.lookaheadStrategy = (0, has_1.default)(config, \"lookaheadStrategy\") ? config.lookaheadStrategy // assumes end user provides the correct config value/type\n    : new llk_lookahead_1.LLkLookaheadStrategy({\n      maxLookahead: this.maxLookahead\n    });\n    this.lookAheadFuncsCache = new Map();\n  };\n\n  LooksAhead.prototype.preComputeLookaheadFunctions = function (rules) {\n    var _this = this;\n\n    (0, forEach_1.default)(rules, function (currRule) {\n      _this.TRACE_INIT(\"\".concat(currRule.name, \" Rule Lookahead\"), function () {\n        var _a = collectMethods(currRule),\n            alternation = _a.alternation,\n            repetition = _a.repetition,\n            option = _a.option,\n            repetitionMandatory = _a.repetitionMandatory,\n            repetitionMandatoryWithSeparator = _a.repetitionMandatoryWithSeparator,\n            repetitionWithSeparator = _a.repetitionWithSeparator;\n\n        (0, forEach_1.default)(alternation, function (currProd) {\n          var prodIdx = currProd.idx === 0 ? \"\" : currProd.idx;\n\n          _this.TRACE_INIT(\"\".concat((0, gast_2.getProductionDslName)(currProd)).concat(prodIdx), function () {\n            var laFunc = _this.lookaheadStrategy.buildLookaheadForAlternation({\n              prodOccurrence: currProd.idx,\n              rule: currRule,\n              maxLookahead: currProd.maxLookahead || _this.maxLookahead,\n              hasPredicates: currProd.hasPredicates,\n              dynamicTokensEnabled: _this.dynamicTokensEnabled\n            });\n\n            var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[currRule.name], keys_1.OR_IDX, currProd.idx);\n\n            _this.setLaFuncCache(key, laFunc);\n          });\n        });\n        (0, forEach_1.default)(repetition, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_IDX, \"Repetition\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(option, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.OPTION_IDX, \"Option\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionMandatory, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_IDX, \"RepetitionMandatory\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionMandatoryWithSeparator, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_SEP_IDX, \"RepetitionMandatoryWithSeparator\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n        (0, forEach_1.default)(repetitionWithSeparator, function (currProd) {\n          _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_SEP_IDX, \"RepetitionWithSeparator\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n        });\n      });\n    });\n  };\n\n  LooksAhead.prototype.computeLookaheadFunc = function (rule, prodOccurrence, prodKey, prodType, prodMaxLookahead, dslMethodName) {\n    var _this = this;\n\n    this.TRACE_INIT(\"\".concat(dslMethodName).concat(prodOccurrence === 0 ? \"\" : prodOccurrence), function () {\n      var laFunc = _this.lookaheadStrategy.buildLookaheadForOptional({\n        prodOccurrence: prodOccurrence,\n        rule: rule,\n        maxLookahead: prodMaxLookahead || _this.maxLookahead,\n        dynamicTokensEnabled: _this.dynamicTokensEnabled,\n        prodType: prodType\n      });\n\n      var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[rule.name], prodKey, prodOccurrence);\n\n      _this.setLaFuncCache(key, laFunc);\n    });\n  }; // this actually returns a number, but it is always used as a string (object prop key)\n\n\n  LooksAhead.prototype.getKeyForAutomaticLookahead = function (dslMethodIdx, occurrence) {\n    var currRuleShortName = this.getLastExplicitRuleShortName();\n    return (0, keys_1.getKeyForAutomaticLookahead)(currRuleShortName, dslMethodIdx, occurrence);\n  };\n\n  LooksAhead.prototype.getLaFuncFromCache = function (key) {\n    return this.lookAheadFuncsCache.get(key);\n  };\n  /* istanbul ignore next */\n\n\n  LooksAhead.prototype.setLaFuncCache = function (key, value) {\n    this.lookAheadFuncsCache.set(key, value);\n  };\n\n  return LooksAhead;\n}();\n\nexports.LooksAhead = LooksAhead;\n\nvar DslMethodsCollectorVisitor =\n/** @class */\nfunction (_super) {\n  __extends(DslMethodsCollectorVisitor, _super);\n\n  function DslMethodsCollectorVisitor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n    return _this;\n  }\n\n  DslMethodsCollectorVisitor.prototype.reset = function () {\n    this.dslMethods = {\n      option: [],\n      alternation: [],\n      repetition: [],\n      repetitionWithSeparator: [],\n      repetitionMandatory: [],\n      repetitionMandatoryWithSeparator: []\n    };\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitOption = function (option) {\n    this.dslMethods.option.push(option);\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitRepetitionWithSeparator = function (manySep) {\n    this.dslMethods.repetitionWithSeparator.push(manySep);\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatory = function (atLeastOne) {\n    this.dslMethods.repetitionMandatory.push(atLeastOne);\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitRepetitionMandatoryWithSeparator = function (atLeastOneSep) {\n    this.dslMethods.repetitionMandatoryWithSeparator.push(atLeastOneSep);\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitRepetition = function (many) {\n    this.dslMethods.repetition.push(many);\n  };\n\n  DslMethodsCollectorVisitor.prototype.visitAlternation = function (or) {\n    this.dslMethods.alternation.push(or);\n  };\n\n  return DslMethodsCollectorVisitor;\n}(gast_1.GAstVisitor);\n\nvar collectorVisitor = new DslMethodsCollectorVisitor();\n\nfunction collectMethods(rule) {\n  collectorVisitor.reset();\n  rule.accept(collectorVisitor);\n  var dslMethods = collectorVisitor.dslMethods; // avoid uncleaned references\n\n  collectorVisitor.reset();\n  return dslMethods;\n}\n\nexports.collectMethods = collectMethods;","map":{"version":3,"sources":["../../../../../src/parse/parser/traits/looksahead.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.collectMethods = exports.LooksAhead = void 0;\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar has_1 = __importDefault(require(\"lodash/has\"));\nvar parser_1 = require(\"../parser\");\nvar keys_1 = require(\"../../grammar/keys\");\nvar gast_1 = require(\"@chevrotain/gast\");\nvar gast_2 = require(\"@chevrotain/gast\");\nvar llk_lookahead_1 = require(\"../../grammar/llk_lookahead\");\n/**\n * Trait responsible for the lookahead related utilities and optimizations.\n */\nvar LooksAhead = /** @class */ (function () {\n    function LooksAhead() {\n    }\n    LooksAhead.prototype.initLooksAhead = function (config) {\n        this.dynamicTokensEnabled = (0, has_1.default)(config, \"dynamicTokensEnabled\")\n            ? config.dynamicTokensEnabled // assumes end user provides the correct config value/type\n            : parser_1.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled;\n        this.maxLookahead = (0, has_1.default)(config, \"maxLookahead\")\n            ? config.maxLookahead // assumes end user provides the correct config value/type\n            : parser_1.DEFAULT_PARSER_CONFIG.maxLookahead;\n        this.lookaheadStrategy = (0, has_1.default)(config, \"lookaheadStrategy\")\n            ? config.lookaheadStrategy // assumes end user provides the correct config value/type\n            : new llk_lookahead_1.LLkLookaheadStrategy({ maxLookahead: this.maxLookahead });\n        this.lookAheadFuncsCache = new Map();\n    };\n    LooksAhead.prototype.preComputeLookaheadFunctions = function (rules) {\n        var _this = this;\n        (0, forEach_1.default)(rules, function (currRule) {\n            _this.TRACE_INIT(\"\".concat(currRule.name, \" Rule Lookahead\"), function () {\n                var _a = collectMethods(currRule), alternation = _a.alternation, repetition = _a.repetition, option = _a.option, repetitionMandatory = _a.repetitionMandatory, repetitionMandatoryWithSeparator = _a.repetitionMandatoryWithSeparator, repetitionWithSeparator = _a.repetitionWithSeparator;\n                (0, forEach_1.default)(alternation, function (currProd) {\n                    var prodIdx = currProd.idx === 0 ? \"\" : currProd.idx;\n                    _this.TRACE_INIT(\"\".concat((0, gast_2.getProductionDslName)(currProd)).concat(prodIdx), function () {\n                        var laFunc = _this.lookaheadStrategy.buildLookaheadForAlternation({\n                            prodOccurrence: currProd.idx,\n                            rule: currRule,\n                            maxLookahead: currProd.maxLookahead || _this.maxLookahead,\n                            hasPredicates: currProd.hasPredicates,\n                            dynamicTokensEnabled: _this.dynamicTokensEnabled\n                        });\n                        var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[currRule.name], keys_1.OR_IDX, currProd.idx);\n                        _this.setLaFuncCache(key, laFunc);\n                    });\n                });\n                (0, forEach_1.default)(repetition, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_IDX, \"Repetition\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(option, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.OPTION_IDX, \"Option\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionMandatory, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_IDX, \"RepetitionMandatory\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionMandatoryWithSeparator, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.AT_LEAST_ONE_SEP_IDX, \"RepetitionMandatoryWithSeparator\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n                (0, forEach_1.default)(repetitionWithSeparator, function (currProd) {\n                    _this.computeLookaheadFunc(currRule, currProd.idx, keys_1.MANY_SEP_IDX, \"RepetitionWithSeparator\", currProd.maxLookahead, (0, gast_2.getProductionDslName)(currProd));\n                });\n            });\n        });\n    };\n    LooksAhead.prototype.computeLookaheadFunc = function (rule, prodOccurrence, prodKey, prodType, prodMaxLookahead, dslMethodName) {\n        var _this = this;\n        this.TRACE_INIT(\"\".concat(dslMethodName).concat(prodOccurrence === 0 ? \"\" : prodOccurrence), function () {\n            var laFunc = _this.lookaheadStrategy.buildLookaheadForOptional({\n                prodOccurrence: prodOccurrence,\n                rule: rule,\n                maxLookahead: prodMaxLookahead || _this.maxLookahead,\n                dynamicTokensEnabled: _this.dynamicTokensEnabled,\n                prodType: prodType\n            });\n            var key = (0, keys_1.getKeyForAutomaticLookahead)(_this.fullRuleNameToShort[rule.name], prodKey, prodOccurrence);\n            _this.setLaFuncCache(key, laFunc);\n        });\n    };\n    // this actually returns a number, but it is always used as a string (object prop key)\n    LooksAhead.prototype.getKeyForAutomaticLookahead = function (dslMethodIdx, occurrence) {\n        var currRuleShortName = this.getLastExplicitRuleShortName();\n        return (0, keys_1.getKeyForAutomaticLookahead)(currRuleShortName, dslMethodIdx, occurrence);\n    };\n    LooksAhead.prototype.getLaFuncFromCache = function (key) {\n        return this.lookAheadFuncsCache.get(key);\n    };\n    /* istanbul ignore next */\n    LooksAhead.prototype.setLaFuncCache = function (key, value) {\n        this.lookAheadFuncsCache.set(key, value);\n    };\n    return LooksAhead;\n}());\nexports.LooksAhead = LooksAhead;\nvar DslMethodsCollectorVisitor = /** @class */ (function (_super) {\n    __extends(DslMethodsCollectorVisitor, _super);\n    function DslMethodsCollectorVisitor() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.dslMethods = {\n            option: [],\n            alternation: [],\n            repetition: [],\n            repetitionWithSeparator: [],\n            repetitionMandatory: [],\n            repetitionMandatoryWithSeparator: []\n        };\n        return _this;\n    }\n    DslMethodsCollectorVisitor.prototype.reset = function () {\n        this.dslMethods = {\n            option: [],\n            alternation: [],\n            repetition: [],\n            repetitionWithSeparator: [],\n            repetitionMandatory: [],\n            repetitionMandatoryWithSeparator: []\n        };\n    };\n    DslMethodsCollectorVisitor.prototype.visitOption = function (option) {\n        this.dslMethods.option.push(option);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionWithSeparator = function (manySep) {\n        this.dslMethods.repetitionWithSeparator.push(manySep);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionMandatory = function (atLeastOne) {\n        this.dslMethods.repetitionMandatory.push(atLeastOne);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetitionMandatoryWithSeparator = function (atLeastOneSep) {\n        this.dslMethods.repetitionMandatoryWithSeparator.push(atLeastOneSep);\n    };\n    DslMethodsCollectorVisitor.prototype.visitRepetition = function (many) {\n        this.dslMethods.repetition.push(many);\n    };\n    DslMethodsCollectorVisitor.prototype.visitAlternation = function (or) {\n        this.dslMethods.alternation.push(or);\n    };\n    return DslMethodsCollectorVisitor;\n}(gast_1.GAstVisitor));\nvar collectorVisitor = new DslMethodsCollectorVisitor();\nfunction collectMethods(rule) {\n    collectorVisitor.reset();\n    rule.accept(collectorVisitor);\n    var dslMethods = collectorVisitor.dslMethods;\n    // avoid uncleaned references\n    collectorVisitor.reset();\n    return dslMethods;\n}\nexports.collectMethods = collectMethods;\n//# sourceMappingURL=looksahead.js.map"]},"metadata":{},"sourceType":"script"}