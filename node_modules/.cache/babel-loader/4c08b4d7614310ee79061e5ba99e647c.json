{"ast":null,"code":"import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };","map":{"version":3,"sources":["/Users/osamakhan/Desktop/dev/Apple-Animated-React-Clone/node_modules/three-stdlib/postprocessing/BokehPass.js"],"names":["_defineProperty","Pass","FullScreenQuad","WebGLRenderTarget","NearestFilter","MeshDepthMaterial","RGBADepthPacking","NoBlending","UniformsUtils","ShaderMaterial","Color","BokehShader","BokehPass","constructor","scene","camera","params","focus","undefined","aspect","aperture","maxblur","width","window","innerWidth","height","innerHeight","renderTargetDepth","minFilter","magFilter","texture","name","materialDepth","depthPacking","blending","console","error","bokehShader","bokehUniforms","clone","uniforms","value","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","needsSwap","fsQuad","_oldClearColor","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen"],"mappings":"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","sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };\n"]},"metadata":{},"sourceType":"module"}