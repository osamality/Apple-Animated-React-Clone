{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.buildModel = void 0;\n\nvar gast_1 = require(\"@chevrotain/gast\");\n\nvar map_1 = __importDefault(require(\"lodash/map\"));\n\nvar flatten_1 = __importDefault(require(\"lodash/flatten\"));\n\nvar values_1 = __importDefault(require(\"lodash/values\"));\n\nvar some_1 = __importDefault(require(\"lodash/some\"));\n\nvar groupBy_1 = __importDefault(require(\"lodash/groupBy\"));\n\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n\nfunction buildModel(productions) {\n  var generator = new CstNodeDefinitionGenerator();\n  var allRules = (0, values_1.default)(productions);\n  return (0, map_1.default)(allRules, function (rule) {\n    return generator.visitRule(rule);\n  });\n}\n\nexports.buildModel = buildModel;\n\nvar CstNodeDefinitionGenerator =\n/** @class */\nfunction (_super) {\n  __extends(CstNodeDefinitionGenerator, _super);\n\n  function CstNodeDefinitionGenerator() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  CstNodeDefinitionGenerator.prototype.visitRule = function (node) {\n    var rawElements = this.visitEach(node.definition);\n    var grouped = (0, groupBy_1.default)(rawElements, function (el) {\n      return el.propertyName;\n    });\n    var properties = (0, map_1.default)(grouped, function (group, propertyName) {\n      var allNullable = !(0, some_1.default)(group, function (el) {\n        return !el.canBeNull;\n      }); // In an alternation with a label a property name can have\n      // multiple types.\n\n      var propertyType = group[0].type;\n\n      if (group.length > 1) {\n        propertyType = (0, map_1.default)(group, function (g) {\n          return g.type;\n        });\n      }\n\n      return {\n        name: propertyName,\n        type: propertyType,\n        optional: allNullable\n      };\n    });\n    return {\n      name: node.name,\n      properties: properties\n    };\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitAlternative = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitOption = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetition = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionMandatory = function (node) {\n    return this.visitEach(node.definition);\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionMandatoryWithSeparator = function (node) {\n    return this.visitEach(node.definition).concat({\n      propertyName: node.separator.name,\n      canBeNull: true,\n      type: getType(node.separator)\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionWithSeparator = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    }).concat({\n      propertyName: node.separator.name,\n      canBeNull: true,\n      type: getType(node.separator)\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitAlternation = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitTerminal = function (node) {\n    return [{\n      propertyName: node.label || node.terminalType.name,\n      canBeNull: false,\n      type: getType(node)\n    }];\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitNonTerminal = function (node) {\n    return [{\n      propertyName: node.label || node.nonTerminalName,\n      canBeNull: false,\n      type: getType(node)\n    }];\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitEachAndOverrideWith = function (definition, override) {\n    return (0, map_1.default)(this.visitEach(definition), function (definition) {\n      return (0, assign_1.default)({}, definition, override);\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitEach = function (definition) {\n    var _this = this;\n\n    return (0, flatten_1.default)((0, map_1.default)(definition, function (definition) {\n      return _this.visit(definition);\n    }));\n  };\n\n  return CstNodeDefinitionGenerator;\n}(gast_1.GAstVisitor);\n\nfunction getType(production) {\n  if (production instanceof gast_1.NonTerminal) {\n    return {\n      kind: \"rule\",\n      name: production.referencedRule.name\n    };\n  }\n\n  return {\n    kind: \"token\"\n  };\n}","map":{"version":3,"sources":["../../src/model.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAA,MAAA,GAAA,OAAA,CAAA,kBAAA,CAAA;;AACA,IAAA,KAAA,GAAA,eAAA,CAAA,OAAA,CAAA,YAAA,CAAA,CAAA;;AACA,IAAA,SAAA,GAAA,eAAA,CAAA,OAAA,CAAA,gBAAA,CAAA,CAAA;;AACA,IAAA,QAAA,GAAA,eAAA,CAAA,OAAA,CAAA,eAAA,CAAA,CAAA;;AACA,IAAA,MAAA,GAAA,eAAA,CAAA,OAAA,CAAA,aAAA,CAAA,CAAA;;AACA,IAAA,SAAA,GAAA,eAAA,CAAA,OAAA,CAAA,gBAAA,CAAA,CAAA;;AACA,IAAA,QAAA,GAAA,eAAA,CAAA,OAAA,CAAA,eAAA,CAAA,CAAA;;AAEA,SAAgB,UAAhB,CACE,WADF,EACmC;AAEjC,MAAM,SAAS,GAAG,IAAI,0BAAJ,EAAlB;AACA,MAAM,QAAQ,GAAG,CAAA,GAAA,QAAA,CAAA,OAAA,EAAO,WAAP,CAAjB;AACA,SAAO,CAAA,GAAA,KAAA,CAAA,OAAA,EAAI,QAAJ,EAAc,UAAC,IAAD,EAAK;AAAK,WAAA,SAAS,CAAC,SAAV,CAAA,IAAA,CAAA;AAAyB,GAAjD,CAAP;AACD;;AAND,OAAA,CAAA,UAAA,GAAA,UAAA;;AA8BA,IAAA,0BAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAAyC,EAAA,SAAA,CAAA,0BAAA,EAAA,MAAA,CAAA;;AAAzC,WAAA,0BAAA,GAAA;;AA0GC;;AAzGC,EAAA,0BAAA,CAAA,SAAA,CAAA,SAAA,GAAA,UAAU,IAAV,EAAoB;AAClB,QAAM,WAAW,GAAG,KAAK,SAAL,CAAe,IAAI,CAAC,UAApB,CAApB;AAEA,QAAM,OAAO,GAAG,CAAA,GAAA,SAAA,CAAA,OAAA,EAAQ,WAAR,EAAqB,UAAC,EAAD,EAAG;AAAK,aAAA,EAAE,CAAF,YAAA;AAAe,KAA5C,CAAhB;AACA,QAAM,UAAU,GAAG,CAAA,GAAA,KAAA,CAAA,OAAA,EAAI,OAAJ,EAAa,UAAC,KAAD,EAAQ,YAAR,EAAoB;AAClD,UAAM,WAAW,GAAG,CAAC,CAAA,GAAA,MAAA,CAAA,OAAA,EAAK,KAAL,EAAY,UAAC,EAAD,EAAG;AAAK,eAAA,CAAC,EAAE,CAAH,SAAA;AAAa,OAAjC,CAArB,CADkD,CAGlD;AACA;;AACA,UAAI,YAAY,GAAsB,KAAK,CAAC,CAAD,CAAL,CAAS,IAA/C;;AACA,UAAI,KAAK,CAAC,MAAN,GAAe,CAAnB,EAAsB;AACpB,QAAA,YAAY,GAAG,CAAA,GAAA,KAAA,CAAA,OAAA,EAAI,KAAJ,EAAW,UAAC,CAAD,EAAE;AAAK,iBAAA,CAAC,CAAD,IAAA;AAAM,SAAxB,CAAf;AACD;;AAED,aAAO;AACL,QAAA,IAAI,EAAE,YADD;AAEL,QAAA,IAAI,EAAE,YAFD;AAGL,QAAA,QAAQ,EAAE;AAHL,OAAP;AAKD,KAfkB,CAAnB;AAiBA,WAAO;AACL,MAAA,IAAI,EAAE,IAAI,CAAC,IADN;AAEL,MAAA,UAAU,EAAE;AAFP,KAAP;AAID,GAzBD;;AA2BA,EAAA,0BAAA,CAAA,SAAA,CAAA,gBAAA,GAAA,UAAiB,IAAjB,EAAkC;AAChC,WAAO,KAAK,wBAAL,CAA8B,IAAI,CAAC,UAAnC,EAA+C;AAAE,MAAA,SAAS,EAAE;AAAb,KAA/C,CAAP;AACD,GAFD;;AAIA,EAAA,0BAAA,CAAA,SAAA,CAAA,WAAA,GAAA,UAAY,IAAZ,EAAwB;AACtB,WAAO,KAAK,wBAAL,CAA8B,IAAI,CAAC,UAAnC,EAA+C;AAAE,MAAA,SAAS,EAAE;AAAb,KAA/C,CAAP;AACD,GAFD;;AAIA,EAAA,0BAAA,CAAA,SAAA,CAAA,eAAA,GAAA,UAAgB,IAAhB,EAAgC;AAC9B,WAAO,KAAK,wBAAL,CAA8B,IAAI,CAAC,UAAnC,EAA+C;AAAE,MAAA,SAAS,EAAE;AAAb,KAA/C,CAAP;AACD,GAFD;;AAIA,EAAA,0BAAA,CAAA,SAAA,CAAA,wBAAA,GAAA,UAAyB,IAAzB,EAAkD;AAChD,WAAO,KAAK,SAAL,CAAe,IAAI,CAAC,UAApB,CAAP;AACD,GAFD;;AAIA,EAAA,0BAAA,CAAA,SAAA,CAAA,qCAAA,GAAA,UACE,IADF,EACwC;AAEtC,WAAO,KAAK,SAAL,CAAe,IAAI,CAAC,UAApB,EAAgC,MAAhC,CAAuC;AAC5C,MAAA,YAAY,EAAE,IAAI,CAAC,SAAL,CAAe,IADe;AAE5C,MAAA,SAAS,EAAE,IAFiC;AAG5C,MAAA,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,SAAN;AAH+B,KAAvC,CAAP;AAKD,GARD;;AAUA,EAAA,0BAAA,CAAA,SAAA,CAAA,4BAAA,GAAA,UAA6B,IAA7B,EAA0D;AACxD,WAAO,KAAK,wBAAL,CAA8B,IAAI,CAAC,UAAnC,EAA+C;AACpD,MAAA,SAAS,EAAE;AADyC,KAA/C,EAEJ,MAFI,CAEG;AACR,MAAA,YAAY,EAAE,IAAI,CAAC,SAAL,CAAe,IADrB;AAER,MAAA,SAAS,EAAE,IAFH;AAGR,MAAA,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,SAAN;AAHL,KAFH,CAAP;AAOD,GARD;;AAUA,EAAA,0BAAA,CAAA,SAAA,CAAA,gBAAA,GAAA,UAAiB,IAAjB,EAAkC;AAChC,WAAO,KAAK,wBAAL,CAA8B,IAAI,CAAC,UAAnC,EAA+C;AAAE,MAAA,SAAS,EAAE;AAAb,KAA/C,CAAP;AACD,GAFD;;AAIA,EAAA,0BAAA,CAAA,SAAA,CAAA,aAAA,GAAA,UAAc,IAAd,EAA4B;AAC1B,WAAO,CACL;AACE,MAAA,YAAY,EAAE,IAAI,CAAC,KAAL,IAAc,IAAI,CAAC,YAAL,CAAkB,IADhD;AAEE,MAAA,SAAS,EAAE,KAFb;AAGE,MAAA,IAAI,EAAE,OAAO,CAAC,IAAD;AAHf,KADK,CAAP;AAOD,GARD;;AAUA,EAAA,0BAAA,CAAA,SAAA,CAAA,gBAAA,GAAA,UAAiB,IAAjB,EAAkC;AAChC,WAAO,CACL;AACE,MAAA,YAAY,EAAE,IAAI,CAAC,KAAL,IAAc,IAAI,CAAC,eADnC;AAEE,MAAA,SAAS,EAAE,KAFb;AAGE,MAAA,IAAI,EAAE,OAAO,CAAC,IAAD;AAHf,KADK,CAAP;AAOD,GARD;;AAUQ,EAAA,0BAAA,CAAA,SAAA,CAAA,wBAAA,GAAR,UACE,UADF,EAEE,QAFF,EAEyC;AAEvC,WAAO,CAAA,GAAA,KAAA,CAAA,OAAA,EACL,KAAK,SAAL,CAAe,UAAf,CADK,EAEL,UAAC,UAAD,EAAW;AAAK,aAAA,CAAA,GAAA,QAAA,CAAA,OAAA,EAAO,EAAP,EAAW,UAAX,EAAA,QAAA,CAAA;AAAwD,KAFnE,CAAP;AAID,GARO;;AAUA,EAAA,0BAAA,CAAA,SAAA,CAAA,SAAA,GAAR,UAAkB,UAAlB,EAA2C;AAA3C,QAAA,KAAA,GAAA,IAAA;;AACE,WAAO,CAAA,GAAA,SAAA,CAAA,OAAA,EACL,CAAA,GAAA,KAAA,CAAA,OAAA,EACE,UADF,EAEE,UAAC,UAAD,EAAW;AAAK,aAAA,KAAI,CAAC,KAAL,CAAA,UAAA,CAAA;AAAgD,KAFlE,CADK,CAAP;AAMD,GAPO;;AAQV,SAAA,0BAAA;AAAC,CA1GD,CAAyC,MAAA,CAAA,WAAzC,CAAA;;AAkHA,SAAS,OAAT,CACE,UADF,EACgD;AAE9C,MAAI,UAAU,YAAY,MAAA,CAAA,WAA1B,EAAuC;AACrC,WAAO;AACL,MAAA,IAAI,EAAE,MADD;AAEL,MAAA,IAAI,EAAE,UAAU,CAAC,cAAX,CAA0B;AAF3B,KAAP;AAID;;AAED,SAAO;AAAE,IAAA,IAAI,EAAE;AAAR,GAAP;AACD","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.buildModel = void 0;\nvar gast_1 = require(\"@chevrotain/gast\");\nvar map_1 = __importDefault(require(\"lodash/map\"));\nvar flatten_1 = __importDefault(require(\"lodash/flatten\"));\nvar values_1 = __importDefault(require(\"lodash/values\"));\nvar some_1 = __importDefault(require(\"lodash/some\"));\nvar groupBy_1 = __importDefault(require(\"lodash/groupBy\"));\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\nfunction buildModel(productions) {\n    var generator = new CstNodeDefinitionGenerator();\n    var allRules = (0, values_1.default)(productions);\n    return (0, map_1.default)(allRules, function (rule) { return generator.visitRule(rule); });\n}\nexports.buildModel = buildModel;\nvar CstNodeDefinitionGenerator = /** @class */ (function (_super) {\n    __extends(CstNodeDefinitionGenerator, _super);\n    function CstNodeDefinitionGenerator() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CstNodeDefinitionGenerator.prototype.visitRule = function (node) {\n        var rawElements = this.visitEach(node.definition);\n        var grouped = (0, groupBy_1.default)(rawElements, function (el) { return el.propertyName; });\n        var properties = (0, map_1.default)(grouped, function (group, propertyName) {\n            var allNullable = !(0, some_1.default)(group, function (el) { return !el.canBeNull; });\n            // In an alternation with a label a property name can have\n            // multiple types.\n            var propertyType = group[0].type;\n            if (group.length > 1) {\n                propertyType = (0, map_1.default)(group, function (g) { return g.type; });\n            }\n            return {\n                name: propertyName,\n                type: propertyType,\n                optional: allNullable\n            };\n        });\n        return {\n            name: node.name,\n            properties: properties\n        };\n    };\n    CstNodeDefinitionGenerator.prototype.visitAlternative = function (node) {\n        return this.visitEachAndOverrideWith(node.definition, { canBeNull: true });\n    };\n    CstNodeDefinitionGenerator.prototype.visitOption = function (node) {\n        return this.visitEachAndOverrideWith(node.definition, { canBeNull: true });\n    };\n    CstNodeDefinitionGenerator.prototype.visitRepetition = function (node) {\n        return this.visitEachAndOverrideWith(node.definition, { canBeNull: true });\n    };\n    CstNodeDefinitionGenerator.prototype.visitRepetitionMandatory = function (node) {\n        return this.visitEach(node.definition);\n    };\n    CstNodeDefinitionGenerator.prototype.visitRepetitionMandatoryWithSeparator = function (node) {\n        return this.visitEach(node.definition).concat({\n            propertyName: node.separator.name,\n            canBeNull: true,\n            type: getType(node.separator)\n        });\n    };\n    CstNodeDefinitionGenerator.prototype.visitRepetitionWithSeparator = function (node) {\n        return this.visitEachAndOverrideWith(node.definition, {\n            canBeNull: true\n        }).concat({\n            propertyName: node.separator.name,\n            canBeNull: true,\n            type: getType(node.separator)\n        });\n    };\n    CstNodeDefinitionGenerator.prototype.visitAlternation = function (node) {\n        return this.visitEachAndOverrideWith(node.definition, { canBeNull: true });\n    };\n    CstNodeDefinitionGenerator.prototype.visitTerminal = function (node) {\n        return [\n            {\n                propertyName: node.label || node.terminalType.name,\n                canBeNull: false,\n                type: getType(node)\n            }\n        ];\n    };\n    CstNodeDefinitionGenerator.prototype.visitNonTerminal = function (node) {\n        return [\n            {\n                propertyName: node.label || node.nonTerminalName,\n                canBeNull: false,\n                type: getType(node)\n            }\n        ];\n    };\n    CstNodeDefinitionGenerator.prototype.visitEachAndOverrideWith = function (definition, override) {\n        return (0, map_1.default)(this.visitEach(definition), function (definition) { return (0, assign_1.default)({}, definition, override); });\n    };\n    CstNodeDefinitionGenerator.prototype.visitEach = function (definition) {\n        var _this = this;\n        return (0, flatten_1.default)((0, map_1.default)(definition, function (definition) { return _this.visit(definition); }));\n    };\n    return CstNodeDefinitionGenerator;\n}(gast_1.GAstVisitor));\nfunction getType(production) {\n    if (production instanceof gast_1.NonTerminal) {\n        return {\n            kind: \"rule\",\n            name: production.referencedRule.name\n        };\n    }\n    return { kind: \"token\" };\n}\n//# sourceMappingURL=model.js.map"]},"metadata":{},"sourceType":"script"}