{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { extend, useFrame } from '@react-three/fiber';\nimport mergeRefs from 'react-merge-refs';\n\nconst _inverseMatrix = /*@__PURE__*/new THREE.Matrix4();\n\nconst _ray = /*@__PURE__*/new THREE.Ray();\n\nconst _sphere = /*@__PURE__*/new THREE.Sphere();\n\nconst _position = /*@__PURE__*/new THREE.Vector3();\n\nclass PositionPoint extends THREE.Group {\n  constructor() {\n    super();\n    this.size = 0;\n    this.color = new THREE.Color('white');\n    this.instance = {\n      current: undefined\n    };\n    this.instanceKey = {\n      current: undefined\n    };\n  } // This will allow the virtual instance have bounds\n\n\n  get geometry() {\n    var _this$instance$curren;\n\n    return (_this$instance$curren = this.instance.current) == null ? void 0 : _this$instance$curren.geometry;\n  }\n\n  raycast(raycaster, intersects) {\n    var _raycaster$params$Poi, _raycaster$params$Poi2;\n\n    const parent = this.instance.current;\n    if (!parent || !parent.geometry) return;\n    const instanceId = parent.userData.instances.indexOf(this.instanceKey); // If the instance wasn't found or exceeds the parents draw range, bail out\n\n    if (instanceId === -1 || instanceId > parent.geometry.drawRange.count) return;\n    const threshold = (_raycaster$params$Poi = (_raycaster$params$Poi2 = raycaster.params.Points) == null ? void 0 : _raycaster$params$Poi2.threshold) !== null && _raycaster$params$Poi !== void 0 ? _raycaster$params$Poi : 1;\n\n    _sphere.set(this.getWorldPosition(_position), threshold);\n\n    if (raycaster.ray.intersectsSphere(_sphere) === false) return;\n\n    _inverseMatrix.copy(parent.matrixWorld).invert();\n\n    _ray.copy(raycaster.ray).applyMatrix4(_inverseMatrix);\n\n    const localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\n    const localThresholdSq = localThreshold * localThreshold;\n\n    const rayPointDistanceSq = _ray.distanceSqToPoint(_position);\n\n    if (rayPointDistanceSq < localThresholdSq) {\n      const intersectPoint = new THREE.Vector3();\n\n      _ray.closestPointToPoint(_position, intersectPoint);\n\n      intersectPoint.applyMatrix4(this.matrixWorld);\n      const distance = raycaster.ray.origin.distanceTo(intersectPoint);\n      if (distance < raycaster.near || distance > raycaster.far) return;\n      intersects.push({\n        distance: distance,\n        distanceToRay: Math.sqrt(rayPointDistanceSq),\n        point: intersectPoint,\n        index: instanceId,\n        face: null,\n        object: this\n      });\n    }\n  }\n\n}\n\nlet i, positionRef;\nconst context = /*@__PURE__*/React.createContext(null);\nconst parentMatrix = /*@__PURE__*/new THREE.Matrix4();\nconst position = /*@__PURE__*/new THREE.Vector3();\n/**\n * Instance implementation, relies on react + context to update the attributes based on the children of this component\n */\n\nconst PointsInstances = /*#__PURE__*/React.forwardRef(({\n  children,\n  range,\n  limit = 1000,\n  ...props\n}, ref) => {\n  const parentRef = React.useRef(null);\n  const [refs, setRefs] = React.useState([]);\n  const [[positions, colors, sizes]] = React.useState(() => [new Float32Array(limit * 3), Float32Array.from({\n    length: limit * 3\n  }, () => 1), Float32Array.from({\n    length: limit\n  }, () => 1)]);\n  React.useEffect(() => {\n    // We might be a frame too late? ðŸ¤·â€â™‚ï¸\n    parentRef.current.geometry.attributes.position.needsUpdate = true;\n  });\n  useFrame(() => {\n    parentRef.current.updateMatrix();\n    parentRef.current.updateMatrixWorld();\n    parentMatrix.copy(parentRef.current.matrixWorld).invert();\n    parentRef.current.geometry.drawRange.count = Math.min(limit, range !== undefined ? range : limit, refs.length);\n\n    for (i = 0; i < refs.length; i++) {\n      positionRef = refs[i].current;\n      positionRef.getWorldPosition(position).applyMatrix4(parentMatrix);\n      position.toArray(positions, i * 3);\n      parentRef.current.geometry.attributes.position.needsUpdate = true;\n      positionRef.matrixWorldNeedsUpdate = true;\n      positionRef.color.toArray(colors, i * 3);\n      parentRef.current.geometry.attributes.color.needsUpdate = true;\n      sizes.set([positionRef.size], i);\n      parentRef.current.geometry.attributes.size.needsUpdate = true;\n    }\n  });\n  const api = React.useMemo(() => ({\n    getParent: () => parentRef,\n    subscribe: ref => {\n      setRefs(refs => [...refs, ref]);\n      return () => setRefs(refs => refs.filter(item => item.current !== ref.current));\n    }\n  }), []);\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    userData: {\n      instances: refs\n    },\n    matrixAutoUpdate: false,\n    ref: mergeRefs([ref, parentRef]),\n    raycast: () => null\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / 3,\n    array: positions,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / 3,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), /*#__PURE__*/React.createElement(context.Provider, {\n    value: api\n  }, children));\n});\nconst Point = /*#__PURE__*/React.forwardRef(({\n  children,\n  ...props\n}, ref) => {\n  React.useMemo(() => extend({\n    PositionPoint\n  }), []);\n  const group = React.useRef();\n  const {\n    subscribe,\n    getParent\n  } = React.useContext(context);\n  React.useLayoutEffect(() => subscribe(group), []);\n  return /*#__PURE__*/React.createElement(\"positionPoint\", _extends({\n    instance: getParent(),\n    instanceKey: group,\n    ref: mergeRefs([ref, group])\n  }, props), children);\n});\n/**\n * Buffer implementation, relies on complete buffers of the correct number, leaves it to the user to update them\n */\n\nconst PointsBuffer = /*#__PURE__*/React.forwardRef(({\n  children,\n  positions,\n  colors,\n  sizes,\n  stride = 3,\n  ...props\n}, forwardedRef) => {\n  const pointsRef = React.useRef(null);\n  useFrame(() => {\n    const attr = pointsRef.current.geometry.attributes;\n    attr.position.needsUpdate = true;\n    if (colors) attr.color.needsUpdate = true;\n    if (sizes) attr.size.needsUpdate = true;\n  });\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    ref: mergeRefs([forwardedRef, pointsRef])\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / stride,\n    array: positions,\n    itemSize: stride,\n    usage: THREE.DynamicDrawUsage\n  }), colors && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / stride,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), sizes && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length / stride,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), children);\n});\nconst Points = /*#__PURE__*/React.forwardRef((props, forwardedRef) => {\n  if (props.positions instanceof Float32Array) {\n    return /*#__PURE__*/React.createElement(PointsBuffer, _extends({}, props, {\n      ref: forwardedRef\n    }));\n  } else return /*#__PURE__*/React.createElement(PointsInstances, _extends({}, props, {\n    ref: forwardedRef\n  }));\n});\nexport { Point, Points, PointsBuffer, PositionPoint };","map":{"version":3,"sources":["/Users/osamakhan/Desktop/Apple-Website-Clone-React-master/node_modules/@react-three/drei/core/Points.js"],"names":["_extends","THREE","React","extend","useFrame","mergeRefs","_inverseMatrix","Matrix4","_ray","Ray","_sphere","Sphere","_position","Vector3","PositionPoint","Group","constructor","size","color","Color","instance","current","undefined","instanceKey","geometry","_this$instance$curren","raycast","raycaster","intersects","_raycaster$params$Poi","_raycaster$params$Poi2","parent","instanceId","userData","instances","indexOf","drawRange","count","threshold","params","Points","set","getWorldPosition","ray","intersectsSphere","copy","matrixWorld","invert","applyMatrix4","localThreshold","scale","x","y","z","localThresholdSq","rayPointDistanceSq","distanceSqToPoint","intersectPoint","closestPointToPoint","distance","origin","distanceTo","near","far","push","distanceToRay","Math","sqrt","point","index","face","object","i","positionRef","context","createContext","parentMatrix","position","PointsInstances","forwardRef","children","range","limit","props","ref","parentRef","useRef","refs","setRefs","useState","positions","colors","sizes","Float32Array","from","length","useEffect","attributes","needsUpdate","updateMatrix","updateMatrixWorld","min","toArray","matrixWorldNeedsUpdate","api","useMemo","getParent","subscribe","filter","item","createElement","matrixAutoUpdate","attach","array","itemSize","usage","DynamicDrawUsage","Provider","value","Point","group","useContext","useLayoutEffect","PointsBuffer","stride","forwardedRef","pointsRef","attr"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as THREE from 'three';\nimport * as React from 'react';\nimport { extend, useFrame } from '@react-three/fiber';\nimport mergeRefs from 'react-merge-refs';\n\nconst _inverseMatrix = /*@__PURE__*/new THREE.Matrix4();\n\nconst _ray = /*@__PURE__*/new THREE.Ray();\n\nconst _sphere = /*@__PURE__*/new THREE.Sphere();\n\nconst _position = /*@__PURE__*/new THREE.Vector3();\n\nclass PositionPoint extends THREE.Group {\n  constructor() {\n    super();\n    this.size = 0;\n    this.color = new THREE.Color('white');\n    this.instance = {\n      current: undefined\n    };\n    this.instanceKey = {\n      current: undefined\n    };\n  } // This will allow the virtual instance have bounds\n\n\n  get geometry() {\n    var _this$instance$curren;\n\n    return (_this$instance$curren = this.instance.current) == null ? void 0 : _this$instance$curren.geometry;\n  }\n\n  raycast(raycaster, intersects) {\n    var _raycaster$params$Poi, _raycaster$params$Poi2;\n\n    const parent = this.instance.current;\n    if (!parent || !parent.geometry) return;\n    const instanceId = parent.userData.instances.indexOf(this.instanceKey); // If the instance wasn't found or exceeds the parents draw range, bail out\n\n    if (instanceId === -1 || instanceId > parent.geometry.drawRange.count) return;\n    const threshold = (_raycaster$params$Poi = (_raycaster$params$Poi2 = raycaster.params.Points) == null ? void 0 : _raycaster$params$Poi2.threshold) !== null && _raycaster$params$Poi !== void 0 ? _raycaster$params$Poi : 1;\n\n    _sphere.set(this.getWorldPosition(_position), threshold);\n\n    if (raycaster.ray.intersectsSphere(_sphere) === false) return;\n\n    _inverseMatrix.copy(parent.matrixWorld).invert();\n\n    _ray.copy(raycaster.ray).applyMatrix4(_inverseMatrix);\n\n    const localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\n    const localThresholdSq = localThreshold * localThreshold;\n\n    const rayPointDistanceSq = _ray.distanceSqToPoint(_position);\n\n    if (rayPointDistanceSq < localThresholdSq) {\n      const intersectPoint = new THREE.Vector3();\n\n      _ray.closestPointToPoint(_position, intersectPoint);\n\n      intersectPoint.applyMatrix4(this.matrixWorld);\n      const distance = raycaster.ray.origin.distanceTo(intersectPoint);\n      if (distance < raycaster.near || distance > raycaster.far) return;\n      intersects.push({\n        distance: distance,\n        distanceToRay: Math.sqrt(rayPointDistanceSq),\n        point: intersectPoint,\n        index: instanceId,\n        face: null,\n        object: this\n      });\n    }\n  }\n\n}\nlet i, positionRef;\nconst context = /*@__PURE__*/React.createContext(null);\nconst parentMatrix = /*@__PURE__*/new THREE.Matrix4();\nconst position = /*@__PURE__*/new THREE.Vector3();\n/**\n * Instance implementation, relies on react + context to update the attributes based on the children of this component\n */\n\nconst PointsInstances = /*#__PURE__*/React.forwardRef(({\n  children,\n  range,\n  limit = 1000,\n  ...props\n}, ref) => {\n  const parentRef = React.useRef(null);\n  const [refs, setRefs] = React.useState([]);\n  const [[positions, colors, sizes]] = React.useState(() => [new Float32Array(limit * 3), Float32Array.from({\n    length: limit * 3\n  }, () => 1), Float32Array.from({\n    length: limit\n  }, () => 1)]);\n  React.useEffect(() => {\n    // We might be a frame too late? ðŸ¤·â€â™‚ï¸\n    parentRef.current.geometry.attributes.position.needsUpdate = true;\n  });\n  useFrame(() => {\n    parentRef.current.updateMatrix();\n    parentRef.current.updateMatrixWorld();\n    parentMatrix.copy(parentRef.current.matrixWorld).invert();\n    parentRef.current.geometry.drawRange.count = Math.min(limit, range !== undefined ? range : limit, refs.length);\n\n    for (i = 0; i < refs.length; i++) {\n      positionRef = refs[i].current;\n      positionRef.getWorldPosition(position).applyMatrix4(parentMatrix);\n      position.toArray(positions, i * 3);\n      parentRef.current.geometry.attributes.position.needsUpdate = true;\n      positionRef.matrixWorldNeedsUpdate = true;\n      positionRef.color.toArray(colors, i * 3);\n      parentRef.current.geometry.attributes.color.needsUpdate = true;\n      sizes.set([positionRef.size], i);\n      parentRef.current.geometry.attributes.size.needsUpdate = true;\n    }\n  });\n  const api = React.useMemo(() => ({\n    getParent: () => parentRef,\n    subscribe: ref => {\n      setRefs(refs => [...refs, ref]);\n      return () => setRefs(refs => refs.filter(item => item.current !== ref.current));\n    }\n  }), []);\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    userData: {\n      instances: refs\n    },\n    matrixAutoUpdate: false,\n    ref: mergeRefs([ref, parentRef]),\n    raycast: () => null\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / 3,\n    array: positions,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / 3,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), /*#__PURE__*/React.createElement(context.Provider, {\n    value: api\n  }, children));\n});\nconst Point = /*#__PURE__*/React.forwardRef(({\n  children,\n  ...props\n}, ref) => {\n  React.useMemo(() => extend({\n    PositionPoint\n  }), []);\n  const group = React.useRef();\n  const {\n    subscribe,\n    getParent\n  } = React.useContext(context);\n  React.useLayoutEffect(() => subscribe(group), []);\n  return /*#__PURE__*/React.createElement(\"positionPoint\", _extends({\n    instance: getParent(),\n    instanceKey: group,\n    ref: mergeRefs([ref, group])\n  }, props), children);\n});\n/**\n * Buffer implementation, relies on complete buffers of the correct number, leaves it to the user to update them\n */\n\nconst PointsBuffer = /*#__PURE__*/React.forwardRef(({\n  children,\n  positions,\n  colors,\n  sizes,\n  stride = 3,\n  ...props\n}, forwardedRef) => {\n  const pointsRef = React.useRef(null);\n  useFrame(() => {\n    const attr = pointsRef.current.geometry.attributes;\n    attr.position.needsUpdate = true;\n    if (colors) attr.color.needsUpdate = true;\n    if (sizes) attr.size.needsUpdate = true;\n  });\n  return /*#__PURE__*/React.createElement(\"points\", _extends({\n    ref: mergeRefs([forwardedRef, pointsRef])\n  }, props), /*#__PURE__*/React.createElement(\"bufferGeometry\", null, /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-position\",\n    count: positions.length / stride,\n    array: positions,\n    itemSize: stride,\n    usage: THREE.DynamicDrawUsage\n  }), colors && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-color\",\n    count: colors.length / stride,\n    array: colors,\n    itemSize: 3,\n    usage: THREE.DynamicDrawUsage\n  }), sizes && /*#__PURE__*/React.createElement(\"bufferAttribute\", {\n    attach: \"attributes-size\",\n    count: sizes.length / stride,\n    array: sizes,\n    itemSize: 1,\n    usage: THREE.DynamicDrawUsage\n  })), children);\n});\nconst Points = /*#__PURE__*/React.forwardRef((props, forwardedRef) => {\n  if (props.positions instanceof Float32Array) {\n    return /*#__PURE__*/React.createElement(PointsBuffer, _extends({}, props, {\n      ref: forwardedRef\n    }));\n  } else return /*#__PURE__*/React.createElement(PointsInstances, _extends({}, props, {\n    ref: forwardedRef\n  }));\n});\n\nexport { Point, Points, PointsBuffer, PositionPoint };\n"]},"metadata":{},"sourceType":"module"}